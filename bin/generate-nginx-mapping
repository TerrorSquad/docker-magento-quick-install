#!/bin/bash

STORES=$(bin/mysql <"config/sql/get_stores.sql" | tail -n -1 | jq)
# NUMBER_OF_STORES=$(echo "$STORES" | jq 'length')

printf 'map $http_host $MAGE_RUN_CODE {\n'
printf '  %s\n' "default $(echo "$STORES" | jq -r '.[1].code')"

COUNTER=0
for STORE in $(echo $STORES | jq -r '.[].code'); do
    if [[ "$COUNTER" -gt 0 ]]; then
        printf '  %s\n' 'magento-'"$STORE"'.test '"$STORE"
    fi
    COUNTER="$COUNTER+1"
done

printf '%s\n' "}"
