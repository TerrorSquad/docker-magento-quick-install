#!/bin/bash
set -ex

STORES=$(bin/mysql <"config/sql/get_stores.sql" | tail -n -1 | jq)

echo "use magento;"

COUNTER=0
for STORE_ID in $(echo $STORES | jq -r '.[].store_id'); do

    STORE_CODE=""
    DASH=""
    if [[ ${STORE_ID} -gt 1 ]]; then
        DASH="-"
        STORE_CODE=$(echo $STORES | jq -r ".[${COUNTER}].code")
    fi
    SECURE_BASE_URL="https://magento${DASH}${STORE_CODE}.test/"
    UNSECURE_BASE_URL="http://magento${DASH}${STORE_CODE}.test/"
    SECURE_BASE_LINK_URL="https://magento${DASH}${STORE_CODE}.test/"
    UNSECURE_BASE_LINK_URL="http://magento${DASH}${STORE_CODE}.test/"
    SECURE_BASE_MEDIA_URL=$SECURE_BASE_URL"media"
    UNSECURE_BASE_MEDIA_URL=$UNSECURE_BASE_URL"media"
    SECURE_BASE_STATIC_URL=$SECURE_BASE_URL"static"
    UNSECURE_BASE_STATIC_URL=$UNSECURE_BASE_URL"static"

    SQL_SECURE_BASE_URL="REPLACE INTO core_config_data (value, path, scope_id) VALUES ('${SECURE_BASE_URL}', 'web/secure/base_url', ${STORE_ID});"
    echo $SQL_SECURE_BASE_URL

    SQL_UNSECURE_BASE_URL="REPLACE INTO core_config_data (value, path, scope_id) VALUES ('${UNSECURE_BASE_URL}', 'web/unsecure/base_url', ${STORE_ID});"
    echo $SQL_UNSECURE_BASE_URL

    SQL_SECURE_BASE_LINK_URL="REPLACE INTO core_config_data (value, path, scope_id) VALUES ('${SECURE_BASE_LINK_URL}', 'web/secure/base_link_url', ${STORE_ID});"
    echo $SQL_SECURE_BASE_LINK_URL

    SQL_UNSECURE_BASE_LINK_URL="REPLACE INTO core_config_data (value, path, scope_id) VALUES ('${UNSECURE_BASE_LINK_URL}', 'web/unsecure/base_link_url', ${STORE_ID});"
    echo $SQL_UNSECURE_BASE_LINK_URL

    SQL_SECURE_BASE_MEDIA_URL="REPLACE INTO core_config_data (value, path, scope_id) VALUES ('${SECURE_BASE_MEDIA_URL}', 'web/secure/base_media_url', ${STORE_ID});"
    echo $SQL_SECURE_BASE_MEDIA_URL

    SQL_UNSECURE_BASE_MEDIA_URL="REPLACE INTO core_config_data (value, path, scope_id) VALUES ('${UNSECURE_BASE_MEDIA_URL}', 'web/unsecure/base_media_url', ${STORE_ID});"
    echo $SQL_UNSECURE_BASE_MEDIA_URL

    SQL_SECURE_BASE_STATIC_URL="REPLACE INTO core_config_data (value, path, scope_id) VALUES ('${SECURE_BASE_STATIC_URL}', 'web/secure/base_static_url', ${STORE_ID});"
    echo $SQL_SECURE_BASE_STATIC_URL

    SQL_UNSECURE_BASE_STATIC_URL="REPLACE INTO core_config_data (value, path, scope_id) VALUES ('${UNSECURE_BASE_STATIC_URL}', 'web/unsecure/base_static_url', ${STORE_ID});"
    echo $SQL_UNSECURE_BASE_STATIC_URL

    COUNTER=$(("$COUNTER+1"))
done
